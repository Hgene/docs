이 페이지는 이상탐지(Outlier Detection) 관련된 내용을 소개하고자 작성된 페이지로 2023년에 시도해볼 프로젝트들을 위한 사전조사를 겸하여 작성된 내용입니다. 



## 1. 이상탐지란

이상탐지는 Anomaly Detection, Outlier Detection, Abnormal Detection 등 여러가지 이름으로 혼용되서 사용되고 있습니다. 하지만 목적성은 어느정도 유사하다고 볼 수 있습니다. 비이상적인 활동/데이터를 감지한다. 이진분류(Binary Classification)과 다른 점은 데이터셋에 labeling 클래스가 몇 개 인지에 따라 Task를 구분 할 수 있습니다. 확보된 데이터가 정상/비정상, 일반메일/스팸메일, 정상/비정상, 활동/비활동 유저 등과 같이 labeling이 모두 2개 클래스로 되어 있다면 이 데이터는 이진분류 문제로 접근하는 것이 훨씬 유리합니다. 허나 일반적으로 labeling된 데이터가 확보되어 있는 경우는 드물며, 그 경우를 모두 바를 수 없는 경우도 다수 존재합니다. 이런 경우에 우리는 정상적인 데이터만을 가지고 모델을 학습하여, 비정상데이터를 탐지하는 방식으로 문제를 해결하는데 이를 이상탐지 알고리즘이라 부르고 있습니다.

<br/>

## 2. 데이터 관점에서 보자면

이상탐지는 정상데이터의 분포 및 형상을 학습해야하기 때문에, 데이터의 종류/특성에 따라 해결해야하는 문제가 무한하게 확장됩니다. 데이터의 종류에 따라 크게 (1)수치형/범주형, (2)시계열, (3)이미지, (4)영상 네가지 정도로 구분 할 수 있으며, 각각의 가능한 분석 예시는 아래와 같습니다.
 
### 2-1. 수치형/범주형 데이터

- 결제/구매행위 이상탐지(1일 단위 결제정보)  
- 네트워크 트래픽 이상징후 탐지



### 2-2. 시계열 데이터

- 센서데이터 기반 장비상태 이상감지(온도, 진동/회전 수 등)  
- 주식시장 이상감지



### 2-3. 이미지 데이터

- 의료 MRI, X-ray 등의 이미지 데이터를 활용한 비정상 감지.  
- 반도체/상품 이미지를 활용한 불량품 감지



### 2-4. 영상 데이터

- CCTV 비정상 활동 감지( 화재, 사고, 폭력 등)   




### 이상치 데이터의 형태에 따라서도 달라집니다.

앞서 설명된 데이터의 유형에 따라서도 달라지지만, (1)수치형/범주형 과 (2)시계열 데이터의 경우에는 이상치 값이 어떠한 형상으로 일어나는 지에 따라서도 사용해야하는 알고리즘의 형태가 달라집니다.   
1. 정상데이터의 행태는 몇몇 군집에 의해서 정리되고, 그 외의 범주는 모두 이상치에 해당하는 경우
- 군집화를 활용한 이상탐지
- 개체간 거리 / 데이터의 밀도를 활용한 이상탐지

2. 정상데이터의 형태와 비정상(이상치)의 데이터의 형태가 뚜렷하게 구분이 가능한 경우
- 분류기반의 이상탐지

3. 정상데이터의 형태가 어느정도 통계적인 모습을 보이는 경우
- 분포기반의 이상탐지 모델(모수적 기법)



<br/>

## 3. 데이터 유형별 논문 정리 자료

관련 자료는 깃헙 페이지를 참고하여 정리하였습니다. 자세한 내용은 링크를 통해 참고해주세요! 또한 추가적으로 도움이 될만한 블로그/깃헙도 공유합니다

[이미지 이상탐지] 관련 페이지

 데이터별 SOTA & 알고리즘 소개:   

벤치마킹 라이브러리:  

 논문리뷰 블로그(한글):   

 데이터셋 유형별-방법론별 이상탐지 Survey:  



<br/>

## 4. [딥러닝]이미지 이상탐지의 연구흐름

다음은 딥러닝을 활용한 이상탐지(Image Anomaly Detection)의 연구흐름에 대해서 살펴보겠습니다. 내용은 https://ffighting.tistory.com/130 , https://minimin2.tistory.com/159   페이지의 내용을 요약한 것으로 자세한 내용은 페이지를 참고해주세요! 

모든 논문을 읽고 작성한 것이 아닌만큼, 자세한 내용은 블로그를 더 탐구 하시는 것을 적극 추천하는 바입니다.!



이미지를 활용한 이상탐지의 연구흐름은 크게 네 가지의 가닥을 보입니다. 

Reconstruction: GAN모형을 활용한 방식

One-Class Classification: SVDD의 개념으로 normal data로 hypersphere 를 학습하는 방식

Feature matching: Pretrained Model을 활용하여 그 Feature의 특징을 활용하는 방식

Probabilistic: 확률적 방법론을 딥러닝 학습이 가능하게 한 방식



### 4-1. Reconstruction

이 방식은 주로 GAN 모델 구조를 활용하여 정상데이터를 reconstruction 하도록 네트워크를 학습합니다. AnoGAN이라는 모델이 GAN계열의 anomaly detection 시초버전입니다. Generator 영역에서는 fake image를 진짜 이미지라고 판단하도록 생성하고, Discriminator영역에서는 real/fake 이미지를 구분하도록 학습시킴으로써 모델의 정확도를 높여갑니다. 이 때 모델이 잘 학습되었다면, 정상데이터를 잘 추출할 것입니다. 반대로 모델에 이상 데이터가 들어갔을 때 부정확한 이미지가 나오는 게 될텐데, 저자는 이 점을 활용하여 anomaly score를 산출하고 이에 기반하여 이상치를 탐지합니다.

[ 정상데이터를 잘 학습한 GAN모델로 anomaly score를 추출하는 모습 ]



[ AnoGAN의 도식화된 개념설명 ]



### 4-2. One-Class Classification

그 다음으로 발전한 방식이 one-class classification 입니다. 이 계열의 모델들은 공통적으로 normal feature 들이 한 점에 모이도록 hypersphere(구체)를 학습하고, hypersphere(구체)와 이상하리만큼 멀어진 데이터를 이상치로 판단하는 계열의 알고리즘입니다. 대표적인 논문으로는 SVDD를 딥러닝화 한 OC-Deep-SVDD가 있습니다.

[ OC-Deep SVDD의 도식화된 개념설명 ]

[ 학습된 hypershpere를 기반으로 outlier 탐지 ]



### 4-3. Feature matching 방식

다음은 최근들어 활발하게 연구되고 있는 방식으로, Feature간 distance 또는 확률 분포 기반으로 anomal을 탐지하는 방식입니다. 이 방식은 Pre-trained 모델을 활용하는 방식과 데이터셋에 맞게 adaption하는 두가지 세부방식이 있으며, normal feature의 분포로 부터 얼마나 멀리 떨어져 있는지를 활용하여 anomaly score를 산출합니다. 먼저 정상데이터를  Pre-trained 모델에 넣음으로써 어느정도의 Feature(layer별 변수값) 정상분포를 추출합니다. 이후 데이터가 정상분포의 가운데에서 어느정도 떨어져 있는지를 활용하여 이상치 점수를 산정합니다. 비정상데이터일수록 이상치점수가 높아지게 되고, 이를 이상치로 판단합니다.







### 4-4. Probabilistic 방식

마지막으로 최근 들어 SOTA 를 쏟아내는 Normalizing Flow 방식입니다. 이 부분은 정확하지 않아, 내용을 적게 컨셉만 담았습니다. 자세한 내용은 https://ffighting.tistory.com/entry/Anomaly-Detection-Normalizing-Flows-%ED%95%B5%EC%8B%AC-%EC%A0%95%EB%A6%AC  페이지를 참고하세요!

먼저 Normalizing Flow란 변수들 간에 변환함수( f)와 역함수( f^(-1))가 존재할 때, 변수 Z의 확률분포를 아래와 같이 정의할 수 있다는 개념입니다.

변수 Z간 변환함수와 역함수가 존재

그 때 Z변수의 확률분포

이 때 이 확률분포를 딥러닝을 활용하여 구할 수 있다는 것이 Anomaly detection을 위한 Normalizing Flow 이고, 그 딥러닝 구조를 아래와 같습니다.



만약 이 신경망이 잘 학습된다면 정상적인 값은 확률분포의 범위 내에 속하는 값이 나올 것이고, 이상치값이 들어가는 경우 원래 확률분포에서 벗어난 값이 나올 것이라는 컨셉을 활용한 딥러닝 모형입니다.
